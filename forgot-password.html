<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lupa Password - JHMPRO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="style.css" />
    <script src="auth.js"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              "primary-blue": "#1E3A8A",
              "secondary-blue": "#3B82F6",
              "light-blue": "#EFF6FF",
              "success-green": "#10B981",
              "warning-orange": "#F59E0B",
              "danger-red": "#EF4444",
              "gray-primary": "#374151",
              "gray-secondary": "#6B7280",
              "gray-heading": "#1F2937",
              "gray-bg": "#F9FAFB",
            },
            fontFamily: {
              inter: ["Inter", "system-ui", "sans-serif"],
            },
          },
        },
      };
    </script>
  </head>
  <body
    class="font-inter bg-gradient-to-br from-light-blue to-gray-bg min-h-screen"
  >
    <!-- Forgot Password Container -->
    <div
      class="min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8"
    >
      <div class="max-w-md w-full space-y-8">
        <!-- Back to Login -->
        <div class="text-left">
          <a
            href="login.html"
            class="inline-flex items-center text-primary-blue hover:text-secondary-blue transition-colors"
          >
            <i class="fas fa-arrow-left mr-2"></i>
            Kembali ke Login
          </a>
        </div>

        <!-- Logo and Header -->
        <div class="text-center">
          <div
            class="mx-auto w-32 h-10 bg-primary-blue rounded-lg flex items-center justify-center mb-6"
          >
            <span class="text-white font-bold text-xl">JHMPRO</span>
          </div>
          <h2 class="text-3xl font-bold text-gray-heading mb-2">
            Lupa Password?
          </h2>
          <p class="text-gray-secondary">
            Masukkan email Anda dan kami akan mengirimkan link untuk reset
            password.
          </p>
        </div>

        <!-- Forgot Password Form -->
        <div class="bg-white rounded-xl shadow-lg p-8">
          <form class="space-y-6" id="forgotPasswordForm">
            <!-- Email Field -->
            <div>
              <label
                for="email"
                class="block text-sm font-medium text-gray-heading mb-2"
              >
                <i class="fas fa-envelope mr-2 text-gray-secondary"></i>
                Email
              </label>
              <input
                id="email"
                name="email"
                type="email"
                autocomplete="email"
                required
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-blue focus:border-transparent transition-all duration-200 text-gray-primary"
                placeholder="Masukkan email terdaftar Anda"
              />
              <div class="text-danger-red text-sm mt-1 hidden" id="emailError">
                Email tidak valid atau tidak terdaftar
              </div>
            </div>

            <!-- Submit Button -->
            <div>
              <button
                type="submit"
                class="group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-lg text-white bg-primary-blue hover:bg-secondary-blue focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-blue transition-all duration-200 ripple"
              >
                <span class="absolute left-0 inset-y-0 flex items-center pl-3">
                  <i
                    class="fas fa-paper-plane group-hover:text-white"
                    aria-hidden="true"
                  ></i>
                </span>
                <span id="submitText">Kirim Link Reset</span>
                <div class="hidden ml-2" id="submitSpinner">
                  <i class="fas fa-spinner fa-spin"></i>
                </div>
              </button>
            </div>

            <!-- Help Text -->
            <div class="text-center text-sm text-gray-secondary">
              <p>Tidak menerima email? Periksa folder spam Anda atau</p>
              <button
                type="button"
                class="text-primary-blue hover:text-secondary-blue font-medium transition-colors"
                onclick="resendEmail()"
              >
                kirim ulang
              </button>
            </div>
          </form>

          <!-- Success State (Hidden by default) -->
          <div class="hidden text-center space-y-4" id="successState">
            <div
              class="w-16 h-16 mx-auto bg-success-green rounded-full flex items-center justify-center"
            >
              <i class="fas fa-check text-white text-2xl"></i>
            </div>
            <h3 class="text-xl font-semibold text-gray-heading">
              Email Terkirim!
            </h3>
            <p class="text-gray-secondary">
              Kami telah mengirimkan link reset password ke email Anda. Silakan
              periksa kotak masuk Anda dan ikuti instruksi yang diberikan.
            </p>
            <div
              class="text-sm text-gray-secondary bg-light-blue p-3 rounded-lg"
            >
              <p>
                <strong>Catatan:</strong> Link reset akan berlaku selama 15
                menit.
              </p>
            </div>
            <div class="pt-4">
              <a
                href="login.html"
                class="inline-flex items-center justify-center px-4 py-2 border border-primary-blue text-primary-blue rounded-lg hover:bg-primary-blue hover:text-white transition-all duration-200"
              >
                <i class="fas fa-arrow-left mr-2"></i>
                Kembali ke Login
              </a>
            </div>
          </div>
        </div>

        <!-- Additional Help -->
        <div class="text-center">
          <div class="bg-white rounded-lg p-6 shadow-sm">
            <h4 class="font-semibold text-gray-heading mb-3">Butuh bantuan?</h4>
            <div class="text-sm text-gray-secondary space-y-2">
              <p>
                Jika Anda masih mengalami kesulitan, hubungi tim support kami:
              </p>
              <div class="flex justify-center space-x-4 pt-2">
                <a
                  href="tel:+6281234567890"
                  class="text-primary-blue hover:text-secondary-blue transition-colors"
                >
                  <i class="fas fa-phone mr-1"></i>
                  0812-3456-7890
                </a>
                <a
                  href="mailto:support@jhmpro.com"
                  class="text-primary-blue hover:text-secondary-blue transition-colors"
                >
                  <i class="fas fa-envelope mr-1"></i>
                  support@jhmpro.com
                </a>
              </div>
            </div>
          </div>
        </div>

        <!-- Footer -->
        <div class="text-center">
          <p class="text-xs text-gray-secondary">
            Â© 2025 JHMPRO. Bengkel Motor Terpercaya.
          </p>
        </div>
      </div>
    </div>

    <!-- JavaScript -->
    <script>
      // Prevent access if already logged in
      document.addEventListener("DOMContentLoaded", function () {
        RouteProtection.preventAuthAccess();
      });

      // Form validation and submission
      document
        .getElementById("forgotPasswordForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const email = document.getElementById("email").value.trim();

          // Reset error states
          FormUtils.hideError("email");

          let isValid = true;

          // Email validation
          if (!authManager.validateEmail(email)) {
            FormUtils.showError("email", "Email tidak valid");
            isValid = false;
          } else {
            // Check if email exists
            const user = authManager.getUserByEmail(email);
            if (!user) {
              FormUtils.showError("email", "Email tidak terdaftar");
              isValid = false;
            }
          }

          if (isValid) {
            // Show loading state
            const submitBtn = this.querySelector('button[type="submit"]');
            const submitText = document.getElementById("submitText");
            const submitSpinner = document.getElementById("submitSpinner");

            submitBtn.disabled = true;
            submitText.textContent = "Mengirim email...";
            submitSpinner.classList.remove("hidden");

            // Simulate email sending process
            setTimeout(() => {
              // Store reset request (in real app, this would be handled server-side)
              const resetToken = Math.random().toString(36).substring(2, 15);
              const resetRequest = {
                email: email,
                token: resetToken,
                timestamp: Date.now(),
                expires: Date.now() + 15 * 60 * 1000, // 15 minutes
              };

              localStorage.setItem(
                "jhmpro_reset_request",
                JSON.stringify(resetRequest)
              );

              // Show success state
              document
                .getElementById("forgotPasswordForm")
                .classList.add("hidden");
              document
                .getElementById("successState")
                .classList.remove("hidden");

              // Show success notification
              NotificationManager.show(
                "Link reset password telah dikirim ke email Anda",
                "success"
              );
            }, 2000);
          }
        });

      // Resend email function
      function resendEmail() {
        const email = document.getElementById("email").value.trim();

        if (!email || !authManager.validateEmail(email)) {
          NotificationManager.show(
            "Masukkan email yang valid terlebih dahulu",
            "warning"
          );
          return;
        }

        NotificationManager.show("Email telah dikirim ulang", "info");

        // Simulate resend
        setTimeout(() => {
          const resetToken = Math.random().toString(36).substring(2, 15);
          const resetRequest = {
            email: email,
            token: resetToken,
            timestamp: Date.now(),
            expires: Date.now() + 15 * 60 * 1000,
          };

          localStorage.setItem(
            "jhmpro_reset_request",
            JSON.stringify(resetRequest)
          );
        }, 1000);
      }

      // Auto-fill email from URL parameter (if redirected from login)
      document.addEventListener("DOMContentLoaded", function () {
        const urlParams = new URLSearchParams(window.location.search);
        const email = urlParams.get("email");

        if (email && authManager.validateEmail(email)) {
          document.getElementById("email").value = email;
        }
      });
    </script>

    <style>
      .ripple-effect {
        position: absolute;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.6);
        transform: scale(0);
        animation: ripple-animation 0.6s linear;
        pointer-events: none;
      }

      @keyframes ripple-animation {
        to {
          transform: scale(4);
          opacity: 0;
        }
      }
    </style>
  </body>
</html>
