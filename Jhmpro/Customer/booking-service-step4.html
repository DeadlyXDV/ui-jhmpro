<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Konfirmasi Booking - JHMPRO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              "primary-blue": "#1E3A8A",
              "secondary-blue": "#3B82F6",
              "light-blue": "#EFF6FF",
              "success-green": "#10B981",
              "warning-orange": "#F59E0B",
              "danger-red": "#EF4444",
              "gray-primary": "#374151",
              "gray-secondary": "#6B7280",
              "gray-heading": "#1F2937",
              "gray-bg": "#F9FAFB",
            },
            fontFamily: {
              inter: ["Inter", "system-ui", "sans-serif"],
            },
          },
        },
      };
    </script>
  </head>
  <body class="font-inter bg-gray-bg">
    <!-- Header -->
    <header class="bg-white shadow-sm">
      <nav class="container mx-auto px-4 lg:px-8">
        <div class="flex items-center justify-between h-16">
          <div class="flex items-center space-x-4">
            <a
              href="#"
              onclick="logoutUser(); return false;"
              class="w-8 h-8 bg-primary-blue rounded-lg flex items-center justify-center"
            >
              <span class="text-white font-bold text-sm">JH</span>
            </a>
            <span class="font-bold text-lg text-gray-heading">JHMPRO</span>
          </div>
          <div class="flex items-center space-x-4">
            <a
              href="dashboard-customer.html"
              class="text-secondary-blue hover:text-primary-blue"
              >Dashboard</a
            >
            <div class="relative">
              <button
                id="profile-dropdown"
                class="flex items-center space-x-2 p-2 rounded-lg hover:bg-gray-100 transition-colors duration-200"
              >
                <img
                  src="https://via.placeholder.com/32x32"
                  alt="User"
                  class="w-8 h-8 rounded-full"
                />
                <span class="text-sm font-medium text-gray-primary"
                  >John Doe</span
                >
                <i class="fas fa-chevron-down text-gray-400 text-xs"></i>
              </button>

              <!-- Dropdown Menu -->
              <div
                id="profile-menu"
                class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 hidden z-50"
              >
                <div class="py-2">
                  <a
                    href="#"
                    class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors duration-200"
                  >
                    <i class="fas fa-user text-gray-400 mr-3"></i>
                    Profil
                  </a>
                  <a
                    href="#"
                    class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors duration-200"
                  >
                    <i class="fas fa-cog text-gray-400 mr-3"></i>
                    Pengaturan
                  </a>
                  <hr class="my-2 border-gray-200" />
                  <a
                    href="#"
                    onclick="logoutUser(); return false;"
                    class="flex items-center px-4 py-2 text-sm text-danger-red hover:bg-red-50 transition-colors duration-200"
                  >
                    <i class="fas fa-sign-out-alt text-danger-red mr-3"></i>
                    Keluar
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <div class="container mx-auto px-4 lg:px-8 py-8">
      <!-- Progress Steps -->
      <div class="mb-8">
        <div class="flex items-center justify-between max-w-4xl mx-auto">
          <!-- Step 1 -->
          <div class="flex items-center">
            <div
              class="w-10 h-10 bg-success-green rounded-full flex items-center justify-center text-white font-semibold"
            >
              <i class="fas fa-check text-sm"></i>
            </div>
            <span class="ml-3 text-success-green font-medium">Info Motor</span>
          </div>
          <div class="flex-1 h-1 bg-success-green mx-4"></div>

          <!-- Step 2 -->
          <div class="flex items-center">
            <div
              class="w-10 h-10 bg-success-green rounded-full flex items-center justify-center text-white font-semibold"
            >
              <i class="fas fa-check text-sm"></i>
            </div>
            <span class="ml-3 text-success-green font-medium"
              >Pilih Layanan</span
            >
          </div>
          <div class="flex-1 h-1 bg-success-green mx-4"></div>

          <!-- Step 3 -->
          <div class="flex items-center">
            <div
              class="w-10 h-10 bg-success-green rounded-full flex items-center justify-center text-white font-semibold"
            >
              <i class="fas fa-check text-sm"></i>
            </div>
            <span class="ml-3 text-success-green font-medium">Jadwal</span>
          </div>
          <div class="flex-1 h-1 bg-success-green mx-4"></div>

          <!-- Step 4 -->
          <div class="flex items-center">
            <div
              class="w-10 h-10 bg-primary-blue rounded-full flex items-center justify-center text-white font-semibold"
            >
              4
            </div>
            <span class="ml-3 text-primary-blue font-medium">Konfirmasi</span>
          </div>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Form Container -->
        <div class="lg:col-span-2">
          <div class="bg-white rounded-2xl p-10 shadow-md">
            <h2 class="text-2xl font-semibold text-gray-heading mb-8">
              Konfirmasi Detail Booking
            </h2>

            <!-- Booking Summary -->
            <div class="space-y-6">
              <!-- Vehicle Information -->
              <div class="border border-gray-200 rounded-xl p-6">
                <h3 class="text-lg font-semibold text-gray-heading mb-4">
                  <i class="fas fa-motorcycle text-secondary-blue mr-2"></i>
                  Informasi Motor
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label class="text-sm text-gray-secondary">Motor</label>
                    <p class="font-medium text-gray-heading" id="vehicle-info">
                      -
                    </p>
                  </div>
                  <div>
                    <label class="text-sm text-gray-secondary"
                      >Nomor Polisi</label
                    >
                    <p class="font-medium text-gray-heading" id="license-plate">
                      -
                    </p>
                  </div>
                  <div>
                    <label class="text-sm text-gray-secondary">Kilometer</label>
                    <p class="font-medium text-gray-heading" id="odometer">
                      45.000 km
                    </p>
                  </div>
                  <div>
                    <label class="text-sm text-gray-secondary"
                      >Jenis Motor</label
                    >
                    <p class="font-medium text-gray-heading" id="vehicle-type">
                      Motor Matic
                    </p>
                  </div>
                </div>
              </div>

              <!-- Selected Services -->
              <div class="border border-gray-200 rounded-xl p-6">
                <h3 class="text-lg font-semibold text-gray-heading mb-4">
                  <i class="fas fa-wrench text-warning-orange mr-2"></i>
                  Layanan yang Dipilih
                </h3>
                <div class="space-y-3" id="service-list">
                  <!-- Services will be populated by JavaScript -->
                </div>
                <div class="border-t border-gray-200 mt-4 pt-4">
                  <div class="flex justify-between items-center">
                    <span class="font-medium text-gray-secondary"
                      >Total Estimasi:</span
                    >
                    <div class="text-right">
                      <div
                        class="text-lg font-semibold text-primary-blue"
                        id="total-cost"
                      >
                        -
                      </div>
                      <div
                        class="text-sm text-gray-secondary"
                        id="total-duration"
                      >
                        -
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Schedule Information -->
              <div class="border border-gray-200 rounded-xl p-6">
                <h3 class="text-lg font-semibold text-gray-heading mb-4">
                  <i class="fas fa-calendar text-success-green mr-2"></i>
                  Jadwal Servis
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label class="text-sm text-gray-secondary">Tanggal</label>
                    <p class="font-medium text-gray-heading" id="selected-date">
                      -
                    </p>
                  </div>
                  <div>
                    <label class="text-sm text-gray-secondary">Waktu</label>
                    <p class="font-medium text-gray-heading" id="selected-time">
                      -
                    </p>
                  </div>
                  <div>
                    <label class="text-sm text-gray-secondary">Teknisi</label>
                    <p
                      class="font-medium text-gray-heading"
                      id="selected-technician"
                    >
                      -
                    </p>
                  </div>
                  <div>
                    <label class="text-sm text-gray-secondary"
                      >Estimasi Selesai</label
                    >
                    <p
                      class="font-medium text-gray-heading"
                      id="estimated-completion"
                    >
                      -
                    </p>
                  </div>
                </div>
                <div
                  class="mt-4"
                  id="special-notes-section"
                  style="display: none"
                >
                  <label class="text-sm text-gray-secondary"
                    >Catatan Khusus</label
                  >
                  <p
                    class="font-medium text-gray-heading mt-1"
                    id="special-notes"
                  >
                    -
                  </p>
                </div>
              </div>

              <!-- Terms and Conditions -->
              <div class="border border-gray-200 rounded-xl p-6">
                <h3 class="text-lg font-semibold text-gray-heading mb-4">
                  <i class="fas fa-file-contract text-danger-red mr-2"></i>
                  Syarat dan Ketentuan
                </h3>
                <div class="space-y-3 text-sm text-gray-secondary">
                  <label class="flex items-start">
                    <input
                      type="checkbox"
                      class="mt-1 mr-3 text-secondary-blue"
                      required
                      id="terms-service"
                    />
                    <span
                      >Saya setuju dengan
                      <a href="#" class="text-secondary-blue hover:underline"
                        >syarat dan ketentuan layanan</a
                      >
                      yang berlaku di JHMPRO.</span
                    >
                  </label>
                  <label class="flex items-start">
                    <input
                      type="checkbox"
                      class="mt-1 mr-3 text-secondary-blue"
                      required
                      id="terms-pricing"
                    />
                    <span
                      >Saya memahami bahwa harga yang ditampilkan adalah
                      estimasi dan harga final akan dikonfirmasi setelah
                      pemeriksaan.</span
                    >
                  </label>
                  <label class="flex items-start">
                    <input
                      type="checkbox"
                      class="mt-1 mr-3 text-secondary-blue"
                      required
                      id="terms-schedule"
                    />
                    <span
                      >Saya memahami bahwa jadwal dapat berubah berdasarkan
                      ketersediaan dan akan dikonfirmasi melalui
                      WhatsApp/telepon.</span
                    >
                  </label>
                  <label class="flex items-start">
                    <input
                      type="checkbox"
                      class="mt-1 mr-3 text-secondary-blue"
                      id="terms-marketing"
                    />
                    <span
                      >Saya bersedia menerima informasi promosi dan update
                      layanan dari JHMPRO <em>(opsional)</em>.</span
                    >
                  </label>
                </div>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex justify-between pt-8">
              <a
                href="booking-service-step3.html"
                class="px-8 py-3 border-2 border-gray-300 text-gray-primary rounded-lg hover:bg-gray-50 transition-colors duration-200 text-center"
              >
                Kembali
              </a>
              <button
                type="button"
                id="confirm-booking"
                class="px-8 py-3 bg-success-green text-white rounded-lg hover:bg-green-600 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
                disabled
              >
                <i class="fas fa-check mr-2"></i>Konfirmasi Booking
              </button>
            </div>
          </div>
        </div>

        <!-- Summary Sidebar -->
        <div class="lg:col-span-1">
          <div
            class="bg-gray-bg border border-gray-200 rounded-xl p-6 sticky top-8"
          >
            <h3 class="text-lg font-semibold text-gray-heading mb-4">
              Ringkasan Final
            </h3>

            <!-- Quick Summary -->
            <div class="space-y-3 mb-6">
              <div class="flex justify-between text-sm">
                <span class="text-gray-secondary">Motor:</span>
                <span class="text-gray-primary" id="summary-vehicle">-</span>
              </div>
              <div class="flex justify-between text-sm">
                <span class="text-gray-secondary">Tanggal:</span>
                <span class="text-gray-primary" id="summary-date">-</span>
              </div>
              <div class="flex justify-between text-sm">
                <span class="text-gray-secondary">Waktu:</span>
                <span class="text-gray-primary" id="summary-time">-</span>
              </div>
              <div class="flex justify-between text-sm">
                <span class="text-gray-secondary">Layanan:</span>
                <span class="text-gray-primary" id="summary-services">-</span>
              </div>
            </div>

            <div class="border-t border-gray-300 pt-4 mb-6">
              <div class="flex justify-between font-semibold text-lg">
                <span class="text-gray-heading">Total Estimasi:</span>
                <span class="text-primary-blue" id="summary-total">-</span>
              </div>
            </div>

            <!-- Booking ID Preview -->
            <div class="bg-light-blue p-4 rounded-lg mb-6">
              <h4 class="text-sm font-medium text-gray-heading mb-2">
                ID Booking Anda
              </h4>
              <div class="text-lg font-bold text-primary-blue" id="booking-id">
                #BK-XXXX
              </div>
              <p class="text-xs text-gray-secondary mt-1">
                Simpan ID ini untuk referensi
              </p>
            </div>

            <!-- Next Steps -->
            <div class="bg-white p-4 rounded-lg border">
              <h4 class="text-sm font-semibold text-gray-heading mb-3">
                Langkah Selanjutnya
              </h4>
              <div class="space-y-2 text-xs text-gray-secondary">
                <div class="flex items-start space-x-2">
                  <span
                    class="w-4 h-4 bg-secondary-blue text-white rounded-full flex items-center justify-center text-xs font-bold mt-0.5"
                    >1</span
                  >
                  <span
                    >Kami akan mengirim konfirmasi via WhatsApp dalam 15
                    menit</span
                  >
                </div>
                <div class="flex items-start space-x-2">
                  <span
                    class="w-4 h-4 bg-secondary-blue text-white rounded-full flex items-center justify-center text-xs font-bold mt-0.5"
                    >2</span
                  >
                  <span>Datang ke bengkel sesuai jadwal yang dipilih</span>
                </div>
                <div class="flex items-start space-x-2">
                  <span
                    class="w-4 h-4 bg-secondary-blue text-white rounded-full flex items-center justify-center text-xs font-bold mt-0.5"
                    >3</span
                  >
                  <span
                    >Teknisi akan melakukan pemeriksaan dan konfirmasi
                    harga</span
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Success Modal -->
    <div
      id="success-modal"
      class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4"
    >
      <div class="bg-white rounded-2xl max-w-md w-full p-8 text-center">
        <div
          class="w-16 h-16 bg-success-green rounded-full flex items-center justify-center mx-auto mb-4"
        >
          <i class="fas fa-check text-white text-2xl"></i>
        </div>
        <h3 class="text-xl font-semibold text-gray-heading mb-2">
          Booking Berhasil!
        </h3>
        <p class="text-gray-secondary mb-4">
          Booking Anda telah berhasil dibuat dengan ID
          <strong id="modal-booking-id">#BK-XXXX</strong>
        </p>
        <p class="text-sm text-gray-secondary mb-6">
          Kami akan mengirim konfirmasi melalui WhatsApp dalam 15 menit. Terima
          kasih telah memilih JHMPRO!
        </p>
        <div class="flex space-x-3">
          <a
            href="dashboard-customer.html"
            class="flex-1 px-4 py-2 border border-gray-300 text-gray-primary rounded-lg hover:bg-gray-50 transition-colors duration-200"
          >
            Dashboard
          </a>
          <a
            href="service-history.html"
            class="flex-1 px-4 py-2 bg-primary-blue text-white rounded-lg hover:bg-blue-900 transition-colors duration-200"
          >
            Lihat Booking
          </a>
        </div>
      </div>
    </div>

    <script>
      let bookingData = {};

      // Load all booking data
      function loadBookingData() {
        // Vehicle information
        bookingData.vehicleInfo =
          localStorage.getItem("vehicleInfo") || "Honda Beat 2020";
        bookingData.licensePlate =
          localStorage.getItem("licensePlate") || "B 1234 XYZ";

        // Services
        bookingData.selectedServices = JSON.parse(
          localStorage.getItem("selectedServices") || "[]"
        );
        bookingData.totalCost = parseInt(
          localStorage.getItem("totalCost") || "0"
        );
        bookingData.totalDuration = parseInt(
          localStorage.getItem("totalDuration") || "0"
        );

        // Schedule
        bookingData.selectedDate = localStorage.getItem("selectedDate");
        bookingData.selectedTime = localStorage.getItem("selectedTime");
        bookingData.selectedTechnician =
          localStorage.getItem("selectedTechnician") || "auto";
        bookingData.specialNotes = localStorage.getItem("specialNotes") || "";

        // Generate booking ID
        bookingData.bookingId =
          "#BK-" + Math.random().toString(36).substr(2, 4).toUpperCase();
      }

      // Populate the confirmation form
      function populateConfirmation() {
        // Vehicle info
        document.getElementById("vehicle-info").textContent =
          bookingData.vehicleInfo;
        document.getElementById("license-plate").textContent =
          bookingData.licensePlate;

        // Services
        const serviceList = document.getElementById("service-list");
        serviceList.innerHTML = bookingData.selectedServices
          .map(
            (service) =>
              `<div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
            <div>
              <h4 class="font-medium text-gray-heading">${service.name}</h4>
              <p class="text-sm text-gray-secondary">${
                service.duration
              } menit</p>
            </div>
            <div class="text-right">
              <div class="font-semibold text-gray-heading">Rp ${service.price.toLocaleString(
                "id-ID"
              )}</div>
            </div>
          </div>`
          )
          .join("");

        document.getElementById(
          "total-cost"
        ).textContent = `Rp ${bookingData.totalCost.toLocaleString("id-ID")}`;

        // Format duration
        const hours = Math.floor(bookingData.totalDuration / 60);
        const minutes = bookingData.totalDuration % 60;
        let durationText = "";
        if (hours > 0) durationText += `${hours} jam `;
        if (minutes > 0) durationText += `${minutes} menit`;
        document.getElementById("total-duration").textContent =
          durationText || "0 menit";

        // Schedule
        if (bookingData.selectedDate) {
          const date = new Date(bookingData.selectedDate);
          document.getElementById("selected-date").textContent =
            date.toLocaleDateString("id-ID", {
              weekday: "long",
              year: "numeric",
              month: "long",
              day: "numeric",
            });
        }
        document.getElementById("selected-time").textContent =
          bookingData.selectedTime + " WIB";

        // Technician
        const technicianNames = {
          auto: "Auto Assign (Terbaik Tersedia)",
          agus: "Agus Santoso (Senior Technician)",
          budi: "Budi Wahyono (Expert Technician)",
          charlie: "Charlie Indra (Specialist Technician)",
        };
        document.getElementById("selected-technician").textContent =
          technicianNames[bookingData.selectedTechnician];

        // Estimated completion
        if (bookingData.selectedDate && bookingData.selectedTime) {
          const startTime = new Date(
            `${bookingData.selectedDate}T${bookingData.selectedTime}:00`
          );
          const endTime = new Date(
            startTime.getTime() + bookingData.totalDuration * 60000
          );
          document.getElementById("estimated-completion").textContent =
            endTime.toLocaleTimeString("id-ID", {
              hour: "2-digit",
              minute: "2-digit",
            }) + " WIB";
        }

        // Special notes
        if (bookingData.specialNotes.trim()) {
          document.getElementById("special-notes-section").style.display =
            "block";
          document.getElementById("special-notes").textContent =
            bookingData.specialNotes;
        }

        // Sidebar summary
        document.getElementById("summary-vehicle").textContent =
          bookingData.vehicleInfo;
        document.getElementById("summary-date").textContent = new Date(
          bookingData.selectedDate
        ).toLocaleDateString("id-ID", { day: "numeric", month: "short" });
        document.getElementById("summary-time").textContent =
          bookingData.selectedTime;
        document.getElementById("summary-services").textContent =
          bookingData.selectedServices.length > 2
            ? `${bookingData.selectedServices.length} layanan`
            : bookingData.selectedServices.map((s) => s.name).join(", ");
        document.getElementById(
          "summary-total"
        ).textContent = `Rp ${bookingData.totalCost.toLocaleString("id-ID")}`;

        // Booking ID
        document.getElementById("booking-id").textContent =
          bookingData.bookingId;
        document.getElementById("modal-booking-id").textContent =
          bookingData.bookingId;
      }

      // Handle terms checkbox validation
      function updateConfirmButton() {
        const requiredTerms = [
          "terms-service",
          "terms-pricing",
          "terms-schedule",
        ];
        const allChecked = requiredTerms.every(
          (id) => document.getElementById(id).checked
        );
        document.getElementById("confirm-booking").disabled = !allChecked;
      }

      // Add event listeners to required checkboxes
      ["terms-service", "terms-pricing", "terms-schedule"].forEach((id) => {
        document
          .getElementById(id)
          .addEventListener("change", updateConfirmButton);
      });

      // Handle booking confirmation
      document
        .getElementById("confirm-booking")
        .addEventListener("click", function () {
          // Show loading state
          this.innerHTML =
            '<i class="fas fa-spinner fa-spin mr-2"></i>Memproses...';
          this.disabled = true;

          // Simulate API call
          setTimeout(() => {
            // Save booking to localStorage (simulate database save)
            const booking = {
              ...bookingData,
              status: "pending",
              createdAt: new Date().toISOString(),
              marketingConsent:
                document.getElementById("terms-marketing").checked,
            };

            // Save to bookings array
            const existingBookings = JSON.parse(
              localStorage.getItem("customerBookings") || "[]"
            );
            existingBookings.push(booking);
            localStorage.setItem(
              "customerBookings",
              JSON.stringify(existingBookings)
            );

            // Clear booking process data
            [
              "vehicleInfo",
              "licensePlate",
              "selectedServices",
              "totalCost",
              "totalDuration",
              "selectedDate",
              "selectedTime",
              "selectedTechnician",
              "specialNotes",
            ].forEach((key) => {
              localStorage.removeItem(key);
            });

            // Show success modal
            document.getElementById("success-modal").classList.remove("hidden");
          }, 2000);
        });

      // Initialize
      loadBookingData();
      populateConfirmation();

      // Profile dropdown functionality
      const profileDropdown = document.getElementById("profile-dropdown");
      const profileMenu = document.getElementById("profile-menu");

      function toggleProfileMenu() {
        profileMenu.classList.toggle("hidden");
      }

      function hideProfileMenu() {
        profileMenu.classList.add("hidden");
      }

      profileDropdown.addEventListener("click", (e) => {
        e.stopPropagation();
        toggleProfileMenu();
      });

      // Close dropdown when clicking outside
      document.addEventListener("click", (e) => {
        if (
          !profileDropdown.contains(e.target) &&
          !profileMenu.contains(e.target)
        ) {
          hideProfileMenu();
        }
      });

      // Close dropdown when pressing escape
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") {
          hideProfileMenu();
        }
      });
    </script>

    <!-- Navigation Enhancement Script -->
    <script src="../navigation.js"></script>
    <script src="../auth.js"></script>
  </body>
</html>
