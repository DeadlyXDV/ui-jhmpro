<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pilih Jadwal - JHMPRO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              "primary-blue": "#1E3A8A",
              "secondary-blue": "#3B82F6",
              "light-blue": "#EFF6FF",
              "success-green": "#10B981",
              "warning-orange": "#F59E0B",
              "danger-red": "#EF4444",
              "gray-primary": "#374151",
              "gray-secondary": "#6B7280",
              "gray-heading": "#1F2937",
              "gray-bg": "#F9FAFB",
            },
            fontFamily: {
              inter: ["Inter", "system-ui", "sans-serif"],
            },
          },
        },
      };
    </script>
  </head>
  <body class="font-inter bg-gray-bg">
    <!-- Header -->
    <header class="bg-white shadow-sm">
      <nav class="container mx-auto px-4 lg:px-8">
        <div class="flex items-center justify-between h-16">
          <div class="flex items-center space-x-4">
            <a
              href="#"
              onclick="logoutUser(); return false;"
              class="w-8 h-8 bg-primary-blue rounded-lg flex items-center justify-center"
            >
              <span class="text-white font-bold text-sm">JH</span>
            </a>
            <span class="font-bold text-lg text-gray-heading">JHMPRO</span>
          </div>
          <div class="flex items-center space-x-4">
            <a
              href="dashboard-customer.html"
              class="text-secondary-blue hover:text-primary-blue"
              >Dashboard</a
            >
            <div class="relative">
              <button
                id="profile-dropdown"
                class="flex items-center space-x-2 p-2 rounded-lg hover:bg-gray-100 transition-colors duration-200"
              >
                <img
                  src="https://via.placeholder.com/32x32"
                  alt="User"
                  class="w-8 h-8 rounded-full"
                />
                <span class="text-sm font-medium text-gray-primary"
                  >John Doe</span
                >
                <i class="fas fa-chevron-down text-gray-400 text-xs"></i>
              </button>

              <!-- Dropdown Menu -->
              <div
                id="profile-menu"
                class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 hidden z-50"
              >
                <div class="py-2">
                  <a
                    href="#"
                    class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors duration-200"
                  >
                    <i class="fas fa-user text-gray-400 mr-3"></i>
                    Profil
                  </a>
                  <a
                    href="#"
                    class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors duration-200"
                  >
                    <i class="fas fa-cog text-gray-400 mr-3"></i>
                    Pengaturan
                  </a>
                  <hr class="my-2 border-gray-200" />
                  <a
                    href="#"
                    onclick="logoutUser(); return false;"
                    class="flex items-center px-4 py-2 text-sm text-danger-red hover:bg-red-50 transition-colors duration-200"
                  >
                    <i class="fas fa-sign-out-alt text-danger-red mr-3"></i>
                    Keluar
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <div class="container mx-auto px-4 lg:px-8 py-8">
      <!-- Progress Steps -->
      <div class="mb-8">
        <div class="flex items-center justify-between max-w-4xl mx-auto">
          <!-- Step 1 -->
          <div class="flex items-center">
            <div
              class="w-10 h-10 bg-success-green rounded-full flex items-center justify-center text-white font-semibold"
            >
              <i class="fas fa-check text-sm"></i>
            </div>
            <span class="ml-3 text-success-green font-medium">Info Motor</span>
          </div>
          <div class="flex-1 h-1 bg-success-green mx-4"></div>

          <!-- Step 2 -->
          <div class="flex items-center">
            <div
              class="w-10 h-10 bg-success-green rounded-full flex items-center justify-center text-white font-semibold"
            >
              <i class="fas fa-check text-sm"></i>
            </div>
            <span class="ml-3 text-success-green font-medium"
              >Pilih Layanan</span
            >
          </div>
          <div class="flex-1 h-1 bg-success-green mx-4"></div>

          <!-- Step 3 -->
          <div class="flex items-center">
            <div
              class="w-10 h-10 bg-primary-blue rounded-full flex items-center justify-center text-white font-semibold"
            >
              3
            </div>
            <span class="ml-3 text-primary-blue font-medium">Jadwal</span>
          </div>
          <div class="flex-1 h-1 bg-gray-300 mx-4"></div>

          <!-- Step 4 -->
          <div class="flex items-center">
            <div
              class="w-10 h-10 bg-gray-300 rounded-full flex items-center justify-center text-gray-600 font-semibold"
            >
              4
            </div>
            <span class="ml-3 text-gray-secondary font-medium">Konfirmasi</span>
          </div>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Form Container -->
        <div class="lg:col-span-2">
          <div class="bg-white rounded-2xl p-10 shadow-md">
            <h2 class="text-2xl font-semibold text-gray-heading mb-8">
              Pilih Jadwal Servis
            </h2>

            <!-- Date Selection -->
            <div class="mb-8">
              <h3 class="text-lg font-semibold text-gray-heading mb-4">
                Pilih Tanggal
              </h3>
              <div
                class="grid grid-cols-2 md:grid-cols-4 gap-3"
                id="date-options"
              >
                <!-- Date options will be generated by JavaScript -->
              </div>
            </div>

            <!-- Time Selection -->
            <div class="mb-8">
              <h3 class="text-lg font-semibold text-gray-heading mb-4">
                Pilih Waktu
              </h3>
              <div
                class="grid grid-cols-2 md:grid-cols-3 gap-3"
                id="time-options"
              >
                <!-- Time options will be populated based on selected date -->
              </div>
            </div>

            <!-- Preferred Technician (Optional) -->
            <div class="mb-8">
              <h3 class="text-lg font-semibold text-gray-heading mb-4">
                Teknisi Pilihan (Opsional)
              </h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <label
                  class="flex items-center p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-secondary-blue transition-colors duration-200"
                >
                  <input
                    type="radio"
                    name="technician"
                    value="auto"
                    class="text-secondary-blue mr-3"
                    checked
                  />
                  <div class="flex items-center space-x-3">
                    <div
                      class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center"
                    >
                      <i class="fas fa-random text-gray-500"></i>
                    </div>
                    <div>
                      <h4 class="font-medium text-gray-heading">Auto Assign</h4>
                      <p class="text-sm text-gray-secondary">
                        Teknisi terbaik tersedia
                      </p>
                    </div>
                  </div>
                </label>

                <label
                  class="flex items-center p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-secondary-blue transition-colors duration-200"
                >
                  <input
                    type="radio"
                    name="technician"
                    value="agus"
                    class="text-secondary-blue mr-3"
                  />
                  <div class="flex items-center space-x-3">
                    <img
                      src="https://via.placeholder.com/40x40"
                      alt="Agus"
                      class="w-10 h-10 rounded-full"
                    />
                    <div>
                      <h4 class="font-medium text-gray-heading">
                        Agus Santoso
                      </h4>
                      <p class="text-sm text-gray-secondary">
                        Senior Technician
                      </p>
                      <div class="flex items-center mt-1">
                        <div class="flex text-warning-orange">
                          <i class="fas fa-star text-xs"></i>
                          <i class="fas fa-star text-xs"></i>
                          <i class="fas fa-star text-xs"></i>
                          <i class="fas fa-star text-xs"></i>
                          <i class="fas fa-star text-xs"></i>
                        </div>
                        <span class="text-xs text-gray-secondary ml-1"
                          >5.0</span
                        >
                      </div>
                    </div>
                  </div>
                </label>

                <label
                  class="flex items-center p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-secondary-blue transition-colors duration-200"
                >
                  <input
                    type="radio"
                    name="technician"
                    value="budi"
                    class="text-secondary-blue mr-3"
                  />
                  <div class="flex items-center space-x-3">
                    <img
                      src="https://via.placeholder.com/40x40"
                      alt="Budi"
                      class="w-10 h-10 rounded-full"
                    />
                    <div>
                      <h4 class="font-medium text-gray-heading">
                        Budi Wahyono
                      </h4>
                      <p class="text-sm text-gray-secondary">
                        Expert Technician
                      </p>
                      <div class="flex items-center mt-1">
                        <div class="flex text-warning-orange">
                          <i class="fas fa-star text-xs"></i>
                          <i class="fas fa-star text-xs"></i>
                          <i class="fas fa-star text-xs"></i>
                          <i class="fas fa-star text-xs"></i>
                          <i class="fas fa-star text-xs"></i>
                        </div>
                        <span class="text-xs text-gray-secondary ml-1"
                          >4.9</span
                        >
                      </div>
                    </div>
                  </div>
                </label>

                <label
                  class="flex items-center p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-secondary-blue transition-colors duration-200"
                >
                  <input
                    type="radio"
                    name="technician"
                    value="charlie"
                    class="text-secondary-blue mr-3"
                  />
                  <div class="flex items-center space-x-3">
                    <img
                      src="https://via.placeholder.com/40x40"
                      alt="Charlie"
                      class="w-10 h-10 rounded-full"
                    />
                    <div>
                      <h4 class="font-medium text-gray-heading">
                        Charlie Indra
                      </h4>
                      <p class="text-sm text-gray-secondary">
                        Specialist Technician
                      </p>
                      <div class="flex items-center mt-1">
                        <div class="flex text-warning-orange">
                          <i class="fas fa-star text-xs"></i>
                          <i class="fas fa-star text-xs"></i>
                          <i class="fas fa-star text-xs"></i>
                          <i class="fas fa-star text-xs"></i>
                          <i class="fas fa-star-half-alt text-xs"></i>
                        </div>
                        <span class="text-xs text-gray-secondary ml-1"
                          >4.8</span
                        >
                      </div>
                    </div>
                  </div>
                </label>
              </div>
            </div>

            <!-- Special Notes -->
            <div class="mb-8">
              <h3 class="text-lg font-semibold text-gray-heading mb-4">
                Catatan Khusus (Opsional)
              </h3>
              <textarea
                id="special-notes"
                rows="4"
                placeholder="Tambahkan catatan khusus atau instruksi untuk teknisi..."
                class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-secondary-blue focus:ring-2 focus:ring-blue-100 transition-all duration-200 placeholder-gray-400 resize-none"
              ></textarea>
            </div>

            <!-- Action Buttons -->
            <div class="flex justify-between pt-6">
              <a
                href="booking-service-step2.html"
                class="px-8 py-3 border-2 border-gray-300 text-gray-primary rounded-lg hover:bg-gray-50 transition-colors duration-200 text-center"
              >
                Kembali
              </a>
              <button
                type="button"
                id="next-step"
                class="px-8 py-3 bg-primary-blue text-white rounded-lg hover:bg-blue-900 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
                disabled
              >
                Lanjutkan
              </button>
            </div>
          </div>
        </div>

        <!-- Summary Sidebar -->
        <div class="lg:col-span-1">
          <div
            class="bg-gray-bg border border-gray-200 rounded-xl p-6 sticky top-8"
          >
            <h3 class="text-lg font-semibold text-gray-heading mb-4">
              Ringkasan Booking
            </h3>

            <!-- Vehicle Info -->
            <div class="space-y-3 mb-6">
              <div class="flex justify-between text-sm">
                <span class="text-gray-secondary">Motor:</span>
                <span class="text-gray-primary" id="vehicle-info">-</span>
              </div>
              <div class="flex justify-between text-sm">
                <span class="text-gray-secondary">Nomor Polisi:</span>
                <span class="text-gray-primary" id="license-plate">-</span>
              </div>
              <div class="flex justify-between text-sm">
                <span class="text-gray-secondary">Layanan:</span>
                <div
                  class="text-gray-primary text-right"
                  id="selected-services"
                >
                  -
                </div>
              </div>
              <div class="flex justify-between text-sm">
                <span class="text-gray-secondary">Tanggal:</span>
                <span class="text-gray-primary" id="selected-date"
                  >Belum dipilih</span
                >
              </div>
              <div class="flex justify-between text-sm">
                <span class="text-gray-secondary">Waktu:</span>
                <span class="text-gray-primary" id="selected-time"
                  >Belum dipilih</span
                >
              </div>
            </div>

            <div class="border-t border-gray-300 pt-4">
              <div class="flex justify-between text-sm mb-2">
                <span class="text-gray-secondary">Estimasi Biaya:</span>
                <span class="text-gray-primary" id="total-cost">-</span>
              </div>
              <div class="flex justify-between text-sm mb-2">
                <span class="text-gray-secondary">Estimasi Waktu:</span>
                <span class="text-gray-primary" id="total-duration">-</span>
              </div>
              <div class="flex justify-between font-semibold text-lg">
                <span class="text-gray-heading">Total:</span>
                <span class="text-primary-blue" id="final-total">-</span>
              </div>
            </div>

            <!-- Availability Info -->
            <div class="mt-6 p-4 bg-light-blue rounded-lg">
              <div class="flex items-start space-x-3">
                <i class="fas fa-info-circle text-secondary-blue mt-1"></i>
                <div>
                  <h4 class="text-sm font-medium text-gray-heading mb-1">
                    Ketersediaan Jadwal
                  </h4>
                  <p class="text-xs text-gray-secondary">
                    • Jadwal dapat berubah berdasarkan ketersediaan<br />
                    • Kami akan konfirmasi jadwal dalam 1 jam<br />
                    • Reschedule dapat dilakukan H-1
                  </p>
                </div>
              </div>
            </div>

            <!-- Contact Info -->
            <div class="mt-6 p-4 bg-white rounded-lg border">
              <h4 class="text-sm font-semibold text-gray-heading mb-3">
                Butuh Bantuan?
              </h4>
              <div class="space-y-2">
                <div class="flex items-center space-x-2 text-sm">
                  <i class="fas fa-phone text-secondary-blue"></i>
                  <span class="text-gray-primary">+62 21 1234 5678</span>
                </div>
                <div class="flex items-center space-x-2 text-sm">
                  <i class="fas fa-envelope text-secondary-blue"></i>
                  <span class="text-gray-primary">support@jhmpro.com</span>
                </div>
                <div class="flex items-center space-x-2 text-sm">
                  <i class="fab fa-whatsapp text-success-green"></i>
                  <span class="text-gray-primary">WhatsApp Support</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      let selectedDate = null;
      let selectedTime = null;
      let selectedServices = [];
      let totalCost = 0;
      let totalDuration = 0;

      // Mock availability data
      const availability = {
        "2024-12-20": ["08:00", "09:00", "10:00", "13:00", "14:00", "15:00"],
        "2024-12-21": ["08:00", "09:00", "11:00", "13:00", "14:00", "16:00"],
        "2024-12-22": ["09:00", "10:00", "11:00", "14:00", "15:00", "16:00"],
        "2024-12-23": ["08:00", "10:00", "11:00", "13:00", "15:00", "16:00"],
        "2024-12-24": ["08:00", "09:00", "10:00", "13:00", "14:00"],
        "2024-12-26": [
          "08:00",
          "09:00",
          "10:00",
          "11:00",
          "13:00",
          "14:00",
          "15:00",
          "16:00",
        ],
        "2024-12-27": ["09:00", "10:00", "11:00", "13:00", "14:00", "15:00"],
      };

      // Load previous step data
      function loadPreviousData() {
        const vehicleInfo =
          localStorage.getItem("vehicleInfo") || "Honda Beat 2020";
        const licensePlate =
          localStorage.getItem("licensePlate") || "B 1234 XYZ";
        selectedServices = JSON.parse(
          localStorage.getItem("selectedServices") || "[]"
        );
        totalCost = parseInt(localStorage.getItem("totalCost") || "0");
        totalDuration = parseInt(localStorage.getItem("totalDuration") || "0");

        document.getElementById("vehicle-info").textContent = vehicleInfo;
        document.getElementById("license-plate").textContent = licensePlate;
        document.getElementById(
          "total-cost"
        ).textContent = `Rp ${totalCost.toLocaleString("id-ID")}`;
        document.getElementById(
          "final-total"
        ).textContent = `Rp ${totalCost.toLocaleString("id-ID")}`;

        // Format duration
        const hours = Math.floor(totalDuration / 60);
        const minutes = totalDuration % 60;
        let durationText = "";
        if (hours > 0) durationText += `${hours} jam `;
        if (minutes > 0) durationText += `${minutes} menit`;
        document.getElementById("total-duration").textContent =
          durationText || "0 menit";

        // Format services
        const serviceNames = selectedServices.map((service) => service.name);
        document.getElementById("selected-services").textContent =
          serviceNames.length > 2
            ? `${serviceNames.length} layanan`
            : serviceNames.join(", ");
      }

      // Generate date options
      function generateDateOptions() {
        const dateContainer = document.getElementById("date-options");
        const today = new Date();

        Object.keys(availability).forEach((dateStr) => {
          const date = new Date(dateStr);
          const isToday = date.toDateString() === today.toDateString();
          const isAvailable = availability[dateStr].length > 0;

          const dateOption = document.createElement("label");
          dateOption.className = `date-option flex flex-col items-center p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-secondary-blue transition-colors duration-200 ${
            !isAvailable ? "opacity-50 cursor-not-allowed" : ""
          }`;

          dateOption.innerHTML = `
            <input type="radio" name="date" value="${dateStr}" class="sr-only" ${
            !isAvailable ? "disabled" : ""
          } />
            <div class="text-sm font-medium text-gray-heading">${date.toLocaleDateString(
              "id-ID",
              { weekday: "short" }
            )}</div>
            <div class="text-lg font-semibold text-gray-heading">${date.getDate()}</div>
            <div class="text-xs text-gray-secondary">${date.toLocaleDateString(
              "id-ID",
              { month: "short" }
            )}</div>
            ${
              isToday
                ? '<div class="text-xs text-secondary-blue font-medium mt-1">Hari ini</div>'
                : ""
            }
            ${
              !isAvailable
                ? '<div class="text-xs text-danger-red mt-1">Penuh</div>'
                : ""
            }
          `;

          if (isAvailable) {
            dateOption.addEventListener("click", () =>
              selectDate(dateStr, dateOption)
            );
          }

          dateContainer.appendChild(dateOption);
        });
      }

      // Generate time options based on selected date
      function generateTimeOptions(dateStr) {
        const timeContainer = document.getElementById("time-options");
        timeContainer.innerHTML = "";

        if (!dateStr || !availability[dateStr]) return;

        availability[dateStr].forEach((timeStr) => {
          const timeOption = document.createElement("label");
          timeOption.className =
            "time-option flex items-center justify-center p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-secondary-blue transition-colors duration-200";

          timeOption.innerHTML = `
            <input type="radio" name="time" value="${timeStr}" class="sr-only" />
            <div class="text-center">
              <div class="font-medium text-gray-heading">${timeStr}</div>
              <div class="text-xs text-gray-secondary">Available</div>
            </div>
          `;

          timeOption.addEventListener("click", () =>
            selectTime(timeStr, timeOption)
          );
          timeContainer.appendChild(timeOption);
        });
      }

      // Handle date selection
      function selectDate(dateStr, element) {
        // Remove previous selection
        document.querySelectorAll(".date-option").forEach((el) => {
          el.classList.remove("border-secondary-blue", "bg-light-blue");
        });

        // Add selection to clicked element
        element.classList.add("border-secondary-blue", "bg-light-blue");

        selectedDate = dateStr;
        const date = new Date(dateStr);
        document.getElementById("selected-date").textContent =
          date.toLocaleDateString("id-ID", {
            weekday: "long",
            year: "numeric",
            month: "long",
            day: "numeric",
          });

        // Reset time selection
        selectedTime = null;
        document.getElementById("selected-time").textContent = "Belum dipilih";

        // Generate time options for selected date
        generateTimeOptions(dateStr);

        updateNextButton();
      }

      // Handle time selection
      function selectTime(timeStr, element) {
        // Remove previous selection
        document.querySelectorAll(".time-option").forEach((el) => {
          el.classList.remove("border-secondary-blue", "bg-light-blue");
        });

        // Add selection to clicked element
        element.classList.add("border-secondary-blue", "bg-light-blue");

        selectedTime = timeStr;
        document.getElementById("selected-time").textContent = timeStr + " WIB";

        updateNextButton();
      }

      // Update next button state
      function updateNextButton() {
        const nextButton = document.getElementById("next-step");
        nextButton.disabled = !selectedDate || !selectedTime;
      }

      // Handle technician selection
      document.querySelectorAll('input[name="technician"]').forEach((radio) => {
        radio.addEventListener("change", function () {
          // Remove previous selection styling
          document.querySelectorAll('input[name="technician"]').forEach((r) => {
            r.closest("label").classList.remove(
              "border-secondary-blue",
              "bg-light-blue"
            );
          });

          // Add selection styling to current choice
          if (this.checked) {
            this.closest("label").classList.add(
              "border-secondary-blue",
              "bg-light-blue"
            );
          }
        });
      });

      // Next step handler
      document
        .getElementById("next-step")
        .addEventListener("click", function () {
          if (!selectedDate || !selectedTime) {
            alert("Mohon pilih tanggal dan waktu servis");
            return;
          }

          // Get selected technician
          const selectedTechnicianRadio = document.querySelector(
            'input[name="technician"]:checked'
          );
          const selectedTechnician = selectedTechnicianRadio
            ? selectedTechnicianRadio.value
            : "auto";

          // Get special notes
          const specialNotes = document.getElementById("special-notes").value;

          // Save schedule data to localStorage
          localStorage.setItem("selectedDate", selectedDate);
          localStorage.setItem("selectedTime", selectedTime);
          localStorage.setItem("selectedTechnician", selectedTechnician);
          localStorage.setItem("specialNotes", specialNotes);

          // Navigate to confirmation step
          window.location.href = "booking-service-step4.html";
        });

      // Initialize
      loadPreviousData();
      generateDateOptions();

      // Set initial technician selection styling
      document
        .querySelector('input[name="technician"]:checked')
        .closest("label")
        .classList.add("border-secondary-blue", "bg-light-blue");

      // Profile dropdown functionality
      const profileDropdown = document.getElementById("profile-dropdown");
      const profileMenu = document.getElementById("profile-menu");

      function toggleProfileMenu() {
        profileMenu.classList.toggle("hidden");
      }

      function hideProfileMenu() {
        profileMenu.classList.add("hidden");
      }

      profileDropdown.addEventListener("click", (e) => {
        e.stopPropagation();
        toggleProfileMenu();
      });

      // Close dropdown when clicking outside
      document.addEventListener("click", (e) => {
        if (
          !profileDropdown.contains(e.target) &&
          !profileMenu.contains(e.target)
        ) {
          hideProfileMenu();
        }
      });

      // Close dropdown when pressing escape
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") {
          hideProfileMenu();
        }
      });
    </script>

    <!-- Navigation Enhancement Script -->
    <script src="../navigation.js"></script>
    <script src="../auth.js"></script>
  </body>
</html>
